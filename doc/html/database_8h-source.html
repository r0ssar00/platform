<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>libplatform: /Users/r0ssar00/Development/Git/platform/platform/database.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.8 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<h1>/Users/r0ssar00/Development/Git/platform/platform/database.h</h1><a href="database_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#ifndef PLATFORM_DATABASE_H</span>
<a name="l00002"></a>00002 <span class="preprocessor"></span><span class="preprocessor">#define PLATFORM_DATABASE_H</span>
<a name="l00003"></a>00003 <span class="preprocessor"></span><span class="preprocessor">#include &lt;platform/sqlite3x.hpp&gt;</span>
<a name="l00016"></a><a class="code" href="database_8h.html#0ad8b2b882792994d2c7317f8321a873">00016</a> <span class="keyword">enum</span> <a class="code" href="database_8h.html#0ad8b2b882792994d2c7317f8321a873" title="the column type enumeration">db_types_t</a> {
<a name="l00018"></a><a class="code" href="database_8h.html#0ad8b2b882792994d2c7317f8321a873c99b77a2d975d9c648868d3d7f39c064">00018</a>         <a class="code" href="database_8h.html#0ad8b2b882792994d2c7317f8321a873c99b77a2d975d9c648868d3d7f39c064" title="integer type">db_type_int</a> = 0,
<a name="l00020"></a><a class="code" href="database_8h.html#0ad8b2b882792994d2c7317f8321a873c224a3ee4db7b7b9a2918d7f085210c1">00020</a>         <a class="code" href="database_8h.html#0ad8b2b882792994d2c7317f8321a873c224a3ee4db7b7b9a2918d7f085210c1" title="string type">db_type_str</a>
<a name="l00021"></a>00021 };
<a name="l00025"></a><a class="code" href="database_8h.html#3ea66fa0f2a59b070aeac05bedd289c8">00025</a> <span class="keyword">enum</span> <a class="code" href="database_8h.html#3ea66fa0f2a59b070aeac05bedd289c8" title="the defer type enumeration">defer_types_t</a> {
<a name="l00027"></a><a class="code" href="database_8h.html#3ea66fa0f2a59b070aeac05bedd289c8b3dffd57d2f741595c247c9a121c081a">00027</a>         <a class="code" href="database_8h.html#3ea66fa0f2a59b070aeac05bedd289c8b3dffd57d2f741595c247c9a121c081a" title="Force the call to defer until commit is called.">defer_force</a> = 0,
<a name="l00029"></a><a class="code" href="database_8h.html#3ea66fa0f2a59b070aeac05bedd289c8ae3001c62ed916202f1bf9d7ec383b22">00029</a>         <a class="code" href="database_8h.html#3ea66fa0f2a59b070aeac05bedd289c8ae3001c62ed916202f1bf9d7ec383b22" title="Force the call to commit immediately.">defer_none</a>
<a name="l00030"></a>00030 };
<a name="l00031"></a>00031 
<a name="l00032"></a>00032 <span class="keyword">class </span><a class="code" href="class_database.html" title="A Database connection to a file.">Database</a>;
<a name="l00033"></a>00033 
<a name="l00038"></a><a class="code" href="class_object.html">00038</a> <span class="keyword">class </span><a class="code" href="class_object.html" title="The core data storage object.">Object</a> {
<a name="l00039"></a>00039 <span class="keyword">public</span>:
<a name="l00042"></a>00042         <a class="code" href="class_object.html#3fadafe3d91ec47d077bd84424c172b5" title="Creates a string Object.">Object</a>(std::string str);
<a name="l00045"></a>00045         <a class="code" href="class_object.html#3fadafe3d91ec47d077bd84424c172b5" title="Creates a string Object.">Object</a>(<span class="keywordtype">int</span> integer);
<a name="l00049"></a>00049         <a class="code" href="database_8h.html#0ad8b2b882792994d2c7317f8321a873" title="the column type enumeration">db_types_t</a> <a class="code" href="class_object.html#da923b4ffcbc9bb94d547876272bbe0f" title="gets the type of the Object">get_type</a>();
<a name="l00053"></a>00053         <span class="keywordtype">bool</span> <a class="code" href="class_object.html#e90b471c8631df576124cf294e271de4" title="gets whether the Object is an int">is_int</a>();
<a name="l00057"></a>00057         <span class="keywordtype">bool</span> <a class="code" href="class_object.html#aea55bb22f2f7497a5623c789586cb1b" title="gets whether the Object is a string">is_string</a>();
<a name="l00063"></a>00063         std::string <a class="code" href="class_object.html#eccd9c2bbbcf569661b2ed038f1a9023" title="returns the internal data as a string.">as_string</a>();
<a name="l00069"></a>00069         <span class="keywordtype">int</span> <a class="code" href="class_object.html#86fb1df0bdc66bc7489d925793ce7aad" title="returns the internal data as int.">as_int</a>();
<a name="l00070"></a>00070 <span class="keyword">private</span>:
<a name="l00071"></a>00071         std::string data_str; <span class="comment">// stores the string data</span>
<a name="l00072"></a>00072         <span class="keywordtype">int</span> data_int; <span class="comment">// stores the int data</span>
<a name="l00073"></a>00073         <a class="code" href="database_8h.html#0ad8b2b882792994d2c7317f8321a873" title="the column type enumeration">db_types_t</a> d_type; <span class="comment">// stores the type</span>
<a name="l00074"></a>00074 };
<a name="l00080"></a><a class="code" href="class_row.html">00080</a> <span class="keyword">class </span><a class="code" href="class_row.html" title="Row stores the data for an entire row.">Row</a> {
<a name="l00081"></a>00081 <span class="keyword">public</span>:
<a name="l00083"></a>00083         <a class="code" href="class_row.html#5cca50abc389396e26ec68cbd3fb6596" title="Creates an empty Row.">Row</a>();
<a name="l00086"></a>00086         <a class="code" href="class_row.html#5cca50abc389396e26ec68cbd3fb6596" title="Creates an empty Row.">Row</a>(std::list&lt;Object&gt; &amp; data);
<a name="l00089"></a>00089         std::list&lt;Object&gt;::iterator <a class="code" href="class_row.html#e6a0311e0aed131578f4d2b4824b9c14" title="Gets an iterator pointing to the first column&amp;#39;s data.">begin</a>();
<a name="l00092"></a>00092         std::list&lt;Object&gt;::iterator <a class="code" href="class_row.html#da1223d6a3f7a3fa44fb75057bb21e57" title="Gets an iterator pointing to the last column&amp;#39;s data.">end</a>();
<a name="l00095"></a>00095         <span class="keywordtype">int</span> <a class="code" href="class_row.html#52f042314ed9b24c776b8123b58094a3" title="Get the number of columns this row has.">column_count</a>();
<a name="l00096"></a>00096 <span class="keyword">private</span>:
<a name="l00097"></a>00097         std::list&lt;Object&gt; dataset; <span class="comment">// stores the column data</span>
<a name="l00098"></a>00098 };
<a name="l00108"></a><a class="code" href="class_column.html">00108</a> <span class="keyword">class </span><a class="code" href="class_column.html" title="The data for a column.">Column</a> {
<a name="l00109"></a>00109 <span class="keyword">public</span>:
<a name="l00113"></a>00113         <a class="code" href="class_column.html#c0ae9ea726478e704ec3f45a0faa1a52" title="Creates a new column with a name and type.">Column</a>(std::string name, <a class="code" href="database_8h.html#0ad8b2b882792994d2c7317f8321a873" title="the column type enumeration">db_types_t</a> type);
<a name="l00122"></a>00122         <a class="code" href="class_column.html#c0ae9ea726478e704ec3f45a0faa1a52" title="Creates a new column with a name and type.">Column</a>(std::string name, <a class="code" href="database_8h.html#0ad8b2b882792994d2c7317f8321a873" title="the column type enumeration">db_types_t</a> type, <span class="keywordtype">int</span> index);
<a name="l00125"></a>00125         <a class="code" href="database_8h.html#0ad8b2b882792994d2c7317f8321a873" title="the column type enumeration">db_types_t</a> <a class="code" href="class_column.html#89f652940930af704b4f382644daca9a" title="Get the data type of the Column.">get_type</a>();
<a name="l00128"></a>00128         std::string <a class="code" href="class_column.html#f5337184da1026f2c56a27df1f104541" title="Get the name of the Column.">get_name</a>();
<a name="l00134"></a>00134         <span class="keywordtype">int</span> <a class="code" href="class_column.html#fa899ec24a65822c1342606fe2282153" title="Get the index of the Column.">get_index</a>();
<a name="l00135"></a>00135 <span class="keyword">private</span>:
<a name="l00136"></a>00136         std::string data_name; <span class="comment">// stores the column name</span>
<a name="l00137"></a>00137         <a class="code" href="database_8h.html#0ad8b2b882792994d2c7317f8321a873" title="the column type enumeration">db_types_t</a> data_type;  <span class="comment">// stores the column tyoe</span>
<a name="l00138"></a>00138         <span class="keywordtype">int</span> data_index;        <span class="comment">// stores the column index</span>
<a name="l00139"></a>00139 };
<a name="l00147"></a><a class="code" href="class_table.html">00147</a> <span class="keyword">class </span><a class="code" href="class_table.html" title="Stores data about a Table.">Table</a> {
<a name="l00148"></a>00148 <span class="keyword">public</span>:
<a name="l00153"></a>00153         <a class="code" href="class_table.html#2966c4078efd355cf28902ee7352364f" title="Creates a new table.">Table</a>(<a class="code" href="class_database.html" title="A Database connection to a file.">Database</a> * db, std::string name, <span class="keywordtype">bool</span> exists = <span class="keyword">true</span>);
<a name="l00159"></a>00159         <a class="code" href="class_table.html#2966c4078efd355cf28902ee7352364f" title="Creates a new table.">Table</a>(<a class="code" href="class_database.html" title="A Database connection to a file.">Database</a> * db, std::string name, std::list&lt;Column&gt; &amp; columns, <span class="keywordtype">bool</span> exists = <span class="keyword">false</span>);
<a name="l00166"></a>00166         <a class="code" href="class_table.html#2966c4078efd355cf28902ee7352364f" title="Creates a new table.">Table</a>(<a class="code" href="class_database.html" title="A Database connection to a file.">Database</a> * db, std::string name, std::string columns, <span class="keywordtype">bool</span> exists = <span class="keyword">false</span>);
<a name="l00167"></a>00167         ~<a class="code" href="class_table.html" title="Stores data about a Table.">Table</a>();
<a name="l00174"></a>00174         <span class="keywordtype">void</span> <a class="code" href="class_table.html#7265498a3b5f93058bcebe84fc14d798" title="Add a row to the database.">add_row</a>(<a class="code" href="class_row.html" title="Row stores the data for an entire row.">Row</a> &amp; data, <a class="code" href="database_8h.html#3ea66fa0f2a59b070aeac05bedd289c8" title="the defer type enumeration">defer_types_t</a> deferred = <a class="code" href="database_8h.html#3ea66fa0f2a59b070aeac05bedd289c8ae3001c62ed916202f1bf9d7ec383b22" title="Force the call to commit immediately.">defer_none</a>);
<a name="l00179"></a>00179         <span class="keywordtype">void</span> <a class="code" href="class_table.html#f96f8e5403cff488b5233e244cb0cf21" title="Add a column to the Table.">add_column</a>(<a class="code" href="class_column.html" title="The data for a column.">Column</a> column, <span class="keywordtype">bool</span> exists = <span class="keyword">true</span>);
<a name="l00183"></a>00183         <span class="keywordtype">void</span> <a class="code" href="class_table.html#b1d4219bd0af198776b3f2d3332c7183" title="Add a std::list&amp;lt;Column&amp;gt; to the Table.">add_columns</a>(std::list&lt;Column&gt; &amp; columns, <span class="keywordtype">bool</span> exists = <span class="keyword">true</span>);
<a name="l00186"></a>00186         std::string <a class="code" href="class_table.html#814d6cddbc025c2bc9f397672228f735" title="Gets the name of the table.">get_name</a>();
<a name="l00189"></a>00189         std::list&lt;Column&gt; * <a class="code" href="class_table.html#48201fd3b637b169c625a8c724de55c0" title="Gets a pointer to a list&amp;lt;Column&amp;gt;.">get_columns</a>();
<a name="l00192"></a>00192         std::list&lt;Row&gt; <a class="code" href="class_table.html#177cc876ab43c535406a37f0de483287" title="Gets the entire set of rows from the Table.">get_rows</a>();
<a name="l00196"></a>00196         <span class="keywordtype">int</span> <a class="code" href="class_table.html#dc07b8b4b1c3e6cca5d82a4c789f63e2" title="Get the last error code.">get_error</a>();
<a name="l00201"></a>00201         std::list&lt;Row&gt; <a class="code" href="class_table.html#b74994bcabcc0209126185b1e497d114" title="Query the database using a particular query.">query</a>(std::string <a class="code" href="class_table.html#b74994bcabcc0209126185b1e497d114" title="Query the database using a particular query.">query</a>);
<a name="l00202"></a>00202 <span class="keyword">private</span>:
<a name="l00203"></a>00203         <span class="comment">// initialize the database with a set of columns</span>
<a name="l00204"></a>00204         <span class="keywordtype">void</span> Table_init(<a class="code" href="class_database.html" title="A Database connection to a file.">Database</a> *db, std::string name, std::list&lt;Column&gt; &amp;columns, <span class="keywordtype">bool</span> exists);
<a name="l00205"></a>00205         <a class="code" href="class_database.html" title="A Database connection to a file.">Database</a> * data_db;               <span class="comment">// connection to the database</span>
<a name="l00206"></a>00206         <span class="keywordtype">int</span> error;                        <span class="comment">// the last error code</span>
<a name="l00207"></a>00207         <span class="keywordtype">int</span> num_columns;                  <span class="comment">// the number of columns</span>
<a name="l00208"></a>00208         std::string data_name;            <span class="comment">// the name of the table</span>
<a name="l00209"></a>00209         std::list&lt;Column&gt; * data_columns; <span class="comment">// the list of columns</span>
<a name="l00210"></a>00210 };
<a name="l00213"></a><a class="code" href="class_database.html">00213</a> <span class="keyword">class </span><a class="code" href="class_database.html" title="A Database connection to a file.">Database</a> {
<a name="l00214"></a>00214 <span class="keyword">public</span>:
<a name="l00216"></a>00216         <a class="code" href="class_database.html#4703c80e6969d33565ea340f768fdadf" title="Creates a non-initialized Database.">Database</a>();
<a name="l00219"></a>00219         <a class="code" href="class_database.html#4703c80e6969d33565ea340f768fdadf" title="Creates a non-initialized Database.">Database</a>(std::string file);
<a name="l00220"></a>00220         <span class="comment">// pass in pointer to list of columns to get.  list is modified so that each entry now has</span>
<a name="l00221"></a>00221         <span class="comment">// a Row result</span>
<a name="l00228"></a>00228 <span class="comment"></span>        <span class="keywordtype">int</span> <a class="code" href="class_database.html#adc4c338470adaf1b5aa7d84f80502f5" title="Execute a query that returns a list of results.">execute_query</a>(std::string query, <a class="code" href="class_table.html" title="Stores data about a Table.">Table</a> &amp; table, std::list&lt;Row&gt; *&amp; results);
<a name="l00233"></a>00233         <span class="keywordtype">int</span> <a class="code" href="class_database.html#0f29cd11726c6206f2b571a5e7cfe18a" title="Execute an arbitrary sql statement optionally deferring the execution until commit()...">execute_statement</a>(std::string statement, <a class="code" href="database_8h.html#3ea66fa0f2a59b070aeac05bedd289c8" title="the defer type enumeration">defer_types_t</a> deferred = <a class="code" href="database_8h.html#3ea66fa0f2a59b070aeac05bedd289c8ae3001c62ed916202f1bf9d7ec383b22" title="Force the call to commit immediately.">defer_none</a>);
<a name="l00236"></a>00236         <span class="keywordtype">int</span> <a class="code" href="class_database.html#f24c50e97c819020c1493717c68e41ca" title="Commit all deferred commands to the database.">commit</a>();
<a name="l00238"></a>00238         <span class="keywordtype">void</span> <a class="code" href="class_database.html#e610304a113c9db4dcdbdea16eee4a9f" title="Clear the deferred commands list.">rollback</a>();
<a name="l00241"></a>00241         <span class="keywordtype">bool</span> <a class="code" href="class_database.html#a862163041f2bed4f388248f5e90f974" title="Checks to see if a database has been loaded.">is_loaded</a>();
<a name="l00242"></a>00242 <span class="keyword">private</span>:
<a name="l00243"></a>00243         <span class="keywordtype">int</span> locked;                                  <span class="comment">// whether the db is locked</span>
<a name="l00244"></a>00244         <span class="keywordtype">bool</span> loaded;                                 <span class="comment">// whether the db is loaded</span>
<a name="l00245"></a>00245         sqlite3x::sqlite3_connection DB;             <span class="comment">// the db connection</span>
<a name="l00246"></a>00246         std::list&lt;std::string&gt; deferred_statements;  <span class="comment">// the deferred statements</span>
<a name="l00247"></a>00247         <span class="keywordtype">void</span> lock();                                 <span class="comment">// lock the database for r/w.  if locked, blocks calling function until unlocked</span>
<a name="l00248"></a>00248         <span class="keywordtype">void</span> unlock();                               <span class="comment">// unlock the database</span>
<a name="l00249"></a>00249 };
<a name="l00250"></a>00250 <span class="preprocessor">#endif</span>
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Wed Jul 29 03:12:49 2009 for libplatform by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.8 </small></address>
</body>
</html>
